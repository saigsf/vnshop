<template>
    <div>
    <div class="site-header" style="clear:both;">
        <div class="container">
            <div class="header-logo">
                <!-- <a href="index.php" title="格美官网"><img src="/static/img/vn-logo.png" /></a> -->
                <router-link to="/"  title="格美官网"><img src="/static/img/vn-logo.png" /></router-link>
            </div>
            <div class="header-nav">
                <ul class="nav-list">
                    <li class="nav-category">
                        <!-- <a class="btn-category-list" href="catalog.php" >全部商品分类</a> -->
                        <router-link to="/goodsList" class="btn-category-list" >全部商品分类</router-link>
                    </li>
                    <li class="nav-item">
                        <a class="link" href="category.php?id=76"><span>购买电视与平板</span></a>
                        <div class='item-children'>
                            <div class="container">
                                <ul class="children-list clearfix">
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=27"><img src="/static/images/201507/27_thumb_G_1437074702008.jpg" alt="小米电视2 40英寸"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=27">格美电视2 40英寸</a></div>
                                        <p class="price">2200<em>元</em>元</p>
                                    </li>
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=28"><img src="/static/images/201507/28_thumb_G_1437074792369.jpg" alt="小米平板 16G"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=28">格美平板 16G</a></div>
                                        <p class="price">1299<em>元</em>元</p>
                                    </li>
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=29"><img src="/static/images/201507/29_thumb_G_1437074933275.jpg" alt="格美盒子增强版 1G"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=29">格美盒子增强版 1G</a></div>
                                        <p class="price">299<em>元</em>元</p>
                                    </li>
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=53"><img src="/static/images/201508/53_thumb_G_1439511514539.jpg" alt="格美电视2S48英寸"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=53">格美电视2S48英寸</a></div>
                                        <p class="price">2999<em>元</em>元</p>
                                    </li>
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=77"><img src="/static/images/201508/77_thumb_G_1440984390480.jpg" alt="格美电视/盒子遥控器"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=77">格美电视/盒子遥控器</a></div>
                                        <p class="price">29<em>元</em>元</p>
                                    </li>
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=76"><img src="/static/images/201508/76_thumb_G_1440984280864.jpg" alt="格美盒子mini版"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=76">格美盒子mini版</a></div>
                                        <p class="price">199<em>元</em>元</p>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </li>
                    <li class="nav-item">
                        <a class="link" href="category.php?id=69"><span>购买手机</span></a>
                        <div class='item-children'>
                            <div class="container">
                                <ul class="children-list clearfix">
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=82"><img src="/static/images/201509/82_thumb_G_1441050801926.jpg" alt="红米手机2A"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=82">红米手机2A</a></div>
                                        <p class="price">899<em>元</em>元</p>
                                    </li>
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=80"><img src="/static/images/201509/80_thumb_G_1441050558701.jpg" alt="格美NOTE"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=80">格美NOTE</a></div>
                                        <p class="price">2199<em>元</em>元</p>
                                    </li>
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=56"><img src="/static/images/201508/56_thumb_G_1440717641715.jpg" alt="格美手机4"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=56">格美手机4</a></div>
                                        <p class="price">1499<em>元</em>元</p>
                                    </li>
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=78"><img src="/static/images/201509/78_thumb_G_1441050387337.jpg" alt="红米Note2"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=78">红米Note2</a></div>
                                        <p class="price">799<em>元</em>元</p>
                                    </li>
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=81"><img src="/static/images/201509/81_thumb_G_1441050609661.jpg" alt="红米手机2"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=81">红米手机2</a></div>
                                        <p class="price">599<em>元</em>元</p>
                                    </li>
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=79"><img src="/static/images/201509/79_thumb_G_1441050485953.jpg" alt="格美Note顶配版 合约机"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=79">格美Note顶配版 合约机</a></div>
                                        <p class="price">2999<em>元</em>元</p>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </li>
                    <li class="nav-item">
                        <a class="link" href="category.php?id=101"><span>耳机音箱与存储卡</span></a>
                        <div class='item-children'>
                            <div class="container">
                                <ul class="children-list clearfix">
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=96"><img src="/static/images/201509/96_thumb_G_1441738537157.jpg" alt="QCY派Q8蓝牙耳机"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=96">QCY派Q8蓝牙耳机</a></div>
                                        <p class="price">60<em>元</em>元</p>
                                    </li>
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=103"><img src="/static/images/201509/103_thumb_G_1441738795942.jpg" alt="铁三角COR150入耳式耳机"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=103">铁三角COR150入耳式耳机</a></div>
                                        <p class="price">139<em>元</em>元</p>
                                    </li>
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=38"><img src="/static/images/201507/38_thumb_G_1437082667838.jpg" alt="格美活塞耳机 炫彩版"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=38">格美活塞耳机 炫彩版</a></div>
                                        <p class="price">39<em>元</em>元</p>
                                    </li>
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=30"><img src="/static/images/201507/30_thumb_G_1437075007558.jpg" alt="格美头戴式耳机"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=30">格美头戴式耳机</a></div>
                                        <p class="price">499<em>元</em>元</p>
                                    </li>
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=47"><img src="/static/images/201508/47_thumb_G_1439331077002.jpg" alt="米兔手机U盘升级版"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=47">米兔手机U盘升级版</a></div>
                                        <p class="price">50<em>元</em>元</p>
                                    </li>
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=46"><img src="/static/images/201507/46_thumb_G_1437092278369.jpg" alt="小钢炮蓝牙音箱"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=46">小钢炮蓝牙音箱</a></div>
                                        <p class="price">129<em>元</em>元</p>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </li>
                    <!-- <li class="nav-item">
                        <a class="link" href="category.php?id=108"><span>保护套与贴膜</span></a>
                        <div class='item-children'>
                            <div class="container">
                                <ul class="children-list clearfix">
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=57"><img src="/static/images/201508/57_thumb_G_1440717888680.jpg" alt="清水软胶保护套"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=57">清水软胶保护套</a></div>
                                        <p class="price">5<em>元</em>元</p>
                                    </li>
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=87"><img src="/static/images/201509/87_thumb_G_1441056303542.jpg" alt="普通高透贴膜(单片装)"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=87">普通高透贴膜(单片装)</a></div>
                                        <p class="price">10<em>元</em>元</p>
                                    </li>
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=86"><img src="/static/images/201509/86_thumb_G_1441056239670.jpg" alt="安卓防尘塞"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=86">安卓防尘塞</a></div>
                                        <p class="price">6<em>元</em>元</p>
                                    </li>
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=84"><img src="/static/images/201509/84_thumb_G_1441056023645.jpg" alt="插卡式翻盖保护套"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=84">插卡式翻盖保护套</a></div>
                                        <p class="price">29<em>元</em>元</p>
                                    </li>
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=85"><img src="/static/images/201509/85_thumb_G_1441056112107.jpg" alt="清水软胶保护套"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=85">清水软胶保护套</a></div>
                                        <p class="price">5<em>元</em>元</p>
                                    </li>
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=88"><img src="/static/images/201509/88_thumb_G_1441056484072.jpg" alt="米兔主题3D保护壳"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=88">米兔主题3D保护壳</a></div>
                                        <p class="price">39<em>元</em>元</p>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </li>
                    <li class="nav-item">
                        <a class="link" href="category.php?id=118"><span>格美生活方式</span></a>
                        <div class='item-children'>
                            <div class="container">
                                <ul class="children-list clearfix">
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=89"><img src="/static/images/201509/89_thumb_G_1441056597778.jpg" alt="纯色开衫卫衣 女款"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=89">纯色开衫卫衣 女款</a></div>
                                        <p class="price">129<em>元</em>元</p>
                                    </li>
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=90"><img src="/static/images/201509/90_thumb_G_1441056659073.jpg" alt="企鹅版米兔"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=90">企鹅版米兔</a></div>
                                        <p class="price">49<em>元</em>元</p>
                                    </li>
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=91"><img src="/static/images/201509/91_thumb_G_1441056702928.jpg" alt="简约多功能双肩包"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=91">简约多功能双肩包</a></div>
                                        <p class="price">99<em>元</em>元</p>
                                    </li>
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=92"><img src="/static/images/201509/92_thumb_G_1441056728120.jpg" alt="格美鼠标垫"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=92">格美鼠标垫</a></div>
                                        <p class="price">5<em>元</em>元</p>
                                    </li>
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=43"><img src="/static/images/201507/43_thumb_G_1437091900155.jpg" alt="小蚁蓝牙自拍杆"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=43">小蚁蓝牙自拍杆</a></div>
                                        <p class="price">129<em>元</em>元</p>
                                    </li>
                                    <li class="first">
                                        <div class="figure figure-thumb">
                                            <a href="goods.php?id=94"><img src="/static/images/201509/94_thumb_G_1441056891849.jpg" alt="猫的秘密"></a>
                                        </div>
                                        <div class="title"><a href="goods.php?id=94">猫的秘密</a></div>
                                        <p class="price">199<em>元</em>元</p>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </li> -->
                </ul>
            </div>
            <!-- <div class="container-user"> -->
            <div class="topbar-cart" id="ECS_CARTINFO">
                <a @click="toCart" class="cart-mini ">
                    <i class="iconfont">&#xe60c;</i> 购物车
                    <span class="mini-cart-num J_cartNum" id="hd_cartnum">({{cartNum}})</span>
                </a>
            </div>
            <div class="topbar-info J_userInfo" id="ECS_MEMBERZONE">
                
                <a class="link" rel="nofollow" v-if="!topName" @click="isLogin=true" >登录</a>
                <a class="link" rel="nofollow" v-else >
                    <i class="fa fa-user"></i>
                    {{topName}}
                </a>
                <!-- <router-link class="link" to="/login" rel="nofollow" >登录</router-link> -->
                <span class="sep"   >|</span>
                <a class="link"  v-if="topName" @click="logOut" rel="nofollow">退出</a>
                <router-link class="link" to="/register"  v-if="!topName" rel="nofollow" >注册</router-link>
            </div>
            <!-- </div> -->
        </div>
        <div id="J_navMenu" class="header-nav-menu" style="display: none;">
            <div class="container"></div>
        </div>


        

    </div>
    <!-- 登录框 -->
        <modal :mdShow="isLogin" >
            <div slot="message" class="md-tit" >
            <h2>登录</h2> 
            </div>
            <button slot="close" class="md-close" @click="isLogin=false" >Close</button>
            <div slot="btnGroup" class="regbox confirm-tips">
                <ul>
                    <li class="law">
                        <input type="text" tabindex="1"   v-model="userName" placeholder="User Name"  class="btn-block">
                    </li>
                    <li class="law">
                        <i class="icon IconPwd"></i>
                        <input type="password" tabindex="2"  v-model="userPwd" placeholder="Password" class="btn-block">
                    </li>
                </ul>
                <div class="law">
                    <a href="javascript:;" class="btn btn-primary btn-block" @click="login" >登录</a>
                </div>
            </div>
        </modal>
        <modal :mdShow="toCartConfirm" >
            <div slot="message" class="confirm-tips" >您还没有登录，亲登录先~</div>
            <button slot="close" class="md-close" @click="toCartConfirm=false" >Close</button>
            <a  slot="btnGroup" class="btn-wrap" >
                <input class="btn btn-gray" type="button" value="取消" @click="toCartConfirm=false" >
                <input class="btn btn-gray" type="button" value="确定" @click="toLogin">
            </a>
        </modal>
        <modal :mdShow="systemError" >
            <div slot="message" class="confirm-tips" >系统错误，请返回首页，并联系网站管理人员：q3185328602</div>
            <button slot="close" class="md-close" @click="systemError=false" >Close</button>
            <a  slot="btnGroup" class="btn-wrap" >
                <input class="btn btn-gray" type="button" value="取消" @click="systemError=false" >
                <input class="btn btn-gray" type="button" value="返回首页" @click="toHome">
            </a>
        </modal>
    </div>



</template>

<script>
import '../../static/css/base.css'
import Modal from '../components/Modal'
import { delCookie, getCookie, encode } from '@/util/util'

export default {
    name: 'HelloWorld',
    props: ['isNowLogin'],
    components:{
        Modal
    },
    data () {
        return {
            userName:'',
            userPwd:'',
            isLogin:false,
            topName:'',
            toCartConfirm:false,
            cartNum:0,
            systemError:false
        }
    },
    created(){
        // this.searchCookie();
        this.checkLogin()
    },
    
    methods:{
        login(){
            this.$https.post('/users/login',{
                userName:this.userName,
                userPwd:encode(this.userPwd)
            }).then(res=>{
                this.isLogin=false;
                this.topName=res.data.data.userName
                this.getTopNum()
            })
        },
        getTopNum(){
            this.$https.post('/users/getCartList').then(res=>{
                this.cartNum=res.data.data.length
            })
        },
        searchCookie(){
            if(getCookie('userName')){
                this.topName=getCookie('userName')
            }
        },
        checkLogin(){
            this.$https.post('/users/checkLogin').then(res=>{
                
                    this.topName=res.data.data
                    this.$https.post('/users/getCartList').then(res=>{
                        this.cartNum=res.data.data.length
                    })
             
                
                
            })
        },
        logOut(){
            this.$https.post('/users/delLogin').then(res=>{
                  
                this.topName=''
                this.$router.push({path:'/'})
                
            })
        },
        toCart(){
            this.$https.post('/users/checkLogin').then(res=>{
                if(res.data.code===0){
                    this.$router.push({path:'/cart'})
                }else if(res.data.code===2000){
                    this.toCartConfirm=true
                }else{
                    this.systemError=true
                }
            })
        },
        toLogin(){
            this.toCartConfirm=false;
            this.isLogin=true;
        },
        toHome(){
            this.systemError=false;
            this.$router.push({path:'/'})
        },
        isError(){
            this.systemError=true
        }
    }
}
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped>

</style>
